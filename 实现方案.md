# ZLIB æ ¼å¼å®ç°æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºç°æœ‰ comprx é¡¹ç›®æ¶æ„ï¼Œæ–°å¢ ZLIB å‹ç¼©æ ¼å¼æ”¯æŒã€‚éµå¾ªé¡¹ç›®ç°æœ‰çš„è®¾è®¡æ¨¡å¼å’Œä»£ç ç»“æ„ï¼Œç¡®ä¿ä¸ç°æœ‰åŠŸèƒ½çš„ä¸€è‡´æ€§å’Œå…¼å®¹æ€§ã€‚

## ğŸ—ï¸ å®ç°æ¶æ„

### ç°æœ‰æ¶æ„åˆ†æ
- **å­åŒ…å‘½åè§„èŒƒ**: `cx` + æ ¼å¼åï¼ˆå¦‚ `cxgzip`, `cxzip`ï¼‰
- **åŠŸèƒ½æ¨¡å—åˆ’åˆ†**: æ¯ä¸ªå­åŒ…åŒ…å«å‹ç¼©ã€è§£å‹ã€å†…å­˜æ“ä½œã€åˆ—è¡¨åŠŸèƒ½
- **é…ç½®ç»Ÿä¸€ç®¡ç†**: é€šè¿‡ `internal/config` ç»Ÿä¸€ç®¡ç†é…ç½®
- **æ ¸å¿ƒé›†æˆ**: é€šè¿‡ `internal/core` è¿›è¡Œæ ¼å¼è·¯ç”±å’Œç»Ÿä¸€è°ƒç”¨

### æ–°å¢å­åŒ…ç»“æ„
```
internal/
â””â”€â”€ cxzlib/          # ZLIB å‹ç¼©æ ¼å¼å®ç°
    â”œâ”€â”€ zlib.go      # å•æ–‡ä»¶å‹ç¼©ï¼ˆç±»ä¼¼ gzip.goï¼‰
    â”œâ”€â”€ unzlib.go    # å•æ–‡ä»¶è§£å‹
    â”œâ”€â”€ memory.go    # å†…å­˜å‹ç¼©/è§£å‹å’Œæµå¼å¤„ç†
    â”œâ”€â”€ list.go      # æ–‡ä»¶åˆ—è¡¨åŠŸèƒ½
    â””â”€â”€ *_test.go    # å¯¹åº”æµ‹è¯•æ–‡ä»¶
```

## ğŸ¯ å®ç°é˜¶æ®µè§„åˆ’

### é˜¶æ®µä¸€ï¼šç±»å‹å®šä¹‰å’ŒåŸºç¡€æ¶æ„
1. **æ‰©å±• types/types.go**
   - æ·»åŠ  ZLIB å‹ç¼©æ ¼å¼å¸¸é‡
   - æ›´æ–°æ ¼å¼æ£€æµ‹å‡½æ•°
   - æ›´æ–°æ”¯æŒæ ¼å¼åˆ—è¡¨

2. **æ›´æ–°é…ç½®ç³»ç»Ÿ**
   - ç¡®ä¿ ZLIB æ ¼å¼æ”¯æŒç°æœ‰å‹ç¼©çº§åˆ«
   - éªŒè¯é…ç½®å…¼å®¹æ€§

### é˜¶æ®µäºŒï¼šZLIB å­åŒ…å®ç°
1. **åˆ›å»º internal/cxzlib/ ç›®å½•**
2. **å®ç°æ ¸å¿ƒåŠŸèƒ½æ–‡ä»¶**ï¼š
   - `zlib.go` - å•æ–‡ä»¶å‹ç¼©
   - `unzlib.go` - å•æ–‡ä»¶è§£å‹
   - `memory.go` - å†…å­˜æ“ä½œå’Œæµå¼å¤„ç†
   - `list.go` - æ–‡ä»¶åˆ—è¡¨åŠŸèƒ½
3. **ç¼–å†™å®Œæ•´æµ‹è¯•ç”¨ä¾‹**

### é˜¶æ®µä¸‰ï¼šæ ¸å¿ƒé›†æˆ
1. **æ›´æ–° internal/core/comprx.go**
   - æ·»åŠ  ZLIB æ ¼å¼çš„è·¯ç”±é€»è¾‘
   - é›†æˆåˆ°ç»Ÿä¸€çš„å‹ç¼©/è§£å‹æ¥å£
2. **æ›´æ–°ä¸»åŒ… API**
   - æ‰©å±• comprx.go ä¸­çš„ä¾¿æ·å‡½æ•°
   - æ·»åŠ  ZLIB æ ¼å¼çš„å†…å­˜å’Œæµå¼ API

### é˜¶æ®µå››ï¼šæµ‹è¯•å’Œæ–‡æ¡£
1. **é›†æˆæµ‹è¯•**
2. **æ€§èƒ½æµ‹è¯•**
3. **æ›´æ–° README.md**
4. **API æ–‡æ¡£å®Œå–„**


## ğŸ“ è¯¦ç»†å®ç°è§„èŒƒ

### ZLIB å­åŒ…å®ç°ç»†èŠ‚

#### 1. zlib.go - å•æ–‡ä»¶å‹ç¼©
```go
package cxzlib

import (
    "compress/zlib"
    "fmt"
    "os"
    "path/filepath"
    
    "gitee.com/MM-Q/comprx/internal/config"
    "gitee.com/MM-Q/comprx/internal/utils"
)

// Zlib å‹ç¼©å•ä¸ªæ–‡ä»¶ä¸ºZLIBæ ¼å¼
func Zlib(dst string, src string, cfg *config.Config) error {
    // å®ç°é€»è¾‘å‚è€ƒ cxgzip/gzip.go
    // 1. è·¯å¾„éªŒè¯å’Œç»å¯¹è·¯å¾„è½¬æ¢
    // 2. æºæ–‡ä»¶æ£€æŸ¥ï¼ˆå¿…é¡»æ˜¯æ–‡ä»¶ï¼Œä¸èƒ½æ˜¯ç›®å½•ï¼‰
    // 3. ç›®æ ‡æ–‡ä»¶è¦†ç›–æ£€æŸ¥
    // 4. è¿›åº¦æ¡åˆå§‹åŒ–
    // 5. åˆ›å»º zlib å†™å…¥å™¨
    // 6. æµå¼å¤åˆ¶æ•°æ®
    // 7. èµ„æºæ¸…ç†
}
```

#### 2. unzlib.go - å•æ–‡ä»¶è§£å‹
```go
package cxzlib

// Unzlib è§£å‹ZLIBæ–‡ä»¶
func Unzlib(src string, dst string, cfg *config.Config) error {
    // å®ç°é€»è¾‘å‚è€ƒ cxgzip/ungzip.go
    // 1. è·¯å¾„éªŒè¯
    // 2. æºæ–‡ä»¶æ£€æŸ¥
    // 3. ç›®æ ‡è·¯å¾„å¤„ç†
    // 4. è¿›åº¦æ¡åˆå§‹åŒ–
    // 5. åˆ›å»º zlib è¯»å–å™¨
    // 6. æµå¼è§£å‹æ•°æ®
    // 7. èµ„æºæ¸…ç†
}
```

#### 3. memory.go - å†…å­˜æ“ä½œå’Œæµå¼å¤„ç†
```go
package cxzlib

import (
    "bytes"
    "compress/zlib"
    "io"
    
    "gitee.com/MM-Q/comprx/internal/config"
    "gitee.com/MM-Q/comprx/types"
)

// CompressBytes å‹ç¼©å­—èŠ‚æ•°æ®åˆ°å†…å­˜
func CompressBytes(data []byte, level types.CompressionLevel) ([]byte, error) {
    // å‚è€ƒ cxgzip/memory.go çš„å®ç°æ¨¡å¼
}

// DecompressBytes ä»å†…å­˜è§£å‹å­—èŠ‚æ•°æ®
func DecompressBytes(compressedData []byte) ([]byte, error) {
    // å‚è€ƒ cxgzip/memory.go çš„å®ç°æ¨¡å¼
}

// CompressString å‹ç¼©å­—ç¬¦ä¸²åˆ°å†…å­˜
func CompressString(text string, level types.CompressionLevel) ([]byte, error) {
    // å¤ç”¨ CompressBytes
}

// DecompressString ä»å†…å­˜è§£å‹ä¸ºå­—ç¬¦ä¸²
func DecompressString(compressedData []byte) (string, error) {
    // å¤ç”¨ DecompressBytes
}

// CompressStream æµå¼å‹ç¼©æ•°æ®
func CompressStream(dst io.Writer, src io.Reader, level types.CompressionLevel) error {
    // å‚è€ƒ cxgzip/memory.go çš„æµå¼å®ç°
}

// DecompressStream æµå¼è§£å‹æ•°æ®
func DecompressStream(dst io.Writer, src io.Reader) error {
    // å‚è€ƒ cxgzip/memory.go çš„æµå¼å®ç°
}
```

#### 4. list.go - æ–‡ä»¶åˆ—è¡¨åŠŸèƒ½
```go
package cxzlib

import (
    "gitee.com/MM-Q/comprx/types"
)

// List åˆ—å‡ºZLIBæ–‡ä»¶ä¿¡æ¯
func List(zlibPath string, limit int, pattern string) (*types.ArchiveInfo, error) {
    // ZLIB æ˜¯å•æ–‡ä»¶å‹ç¼©ï¼Œç±»ä¼¼ GZIP
    // è¿”å›å•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯
    // å‚è€ƒ cxgzip/list.go çš„å®ç°
}
```

### DEFLATE å­åŒ…å®ç°ç»†èŠ‚

#### 1. deflate.go - å‹ç¼©å®ç°
```go
package cxdeflate

import (
    "compress/flate"
    "io"
    
    "gitee.com/MM-Q/comprx/internal/config"
    "gitee.com/MM-Q/comprx/types"
)

// CompressBytes å‹ç¼©å­—èŠ‚æ•°æ®
func CompressBytes(data []byte, level types.CompressionLevel) ([]byte, error) {
    // ä½¿ç”¨ flate.NewWriter å®ç°
}

// CompressStream æµå¼å‹ç¼©
func CompressStream(dst io.Writer, src io.Reader, level types.CompressionLevel) error {
    // ä½¿ç”¨ flate.NewWriter å®ç°æµå¼å‹ç¼©
}
```

#### 2. inflate.go - è§£å‹å®ç°
```go
package cxdeflate

import (
    "compress/flate"
    "io"
)

// DecompressBytes è§£å‹å­—èŠ‚æ•°æ®
func DecompressBytes(compressedData []byte) ([]byte, error) {
    // ä½¿ç”¨ flate.NewReader å®ç°
}

// DecompressStream æµå¼è§£å‹
func DecompressStream(dst io.Writer, src io.Reader) error {
    // ä½¿ç”¨ flate.NewReader å®ç°æµå¼è§£å‹
}
```

#### 3. memory.go - å†…å­˜å’Œæµå¼å¤„ç†
```go
package cxdeflate

// æ•´åˆå‹ç¼©å’Œè§£å‹çš„å†…å­˜æ“ä½œ
// æä¾›å­—ç¬¦ä¸²å‹ç¼©/è§£å‹æ¥å£
// å‚è€ƒ cxgzip/memory.go çš„å®Œæ•´å®ç°æ¨¡å¼
```

### ç±»å‹å®šä¹‰æ‰©å±•

#### types/types.go æ‰©å±•
```go
const (
    // ç°æœ‰æ ¼å¼...
    CompressTypeZlib   CompressType = ".zlib"    // ZLIB å‹ç¼©æ ¼å¼
    CompressTypeDeflate CompressType = ".deflate" // DEFLATE å‹ç¼©æ ¼å¼
)

// æ›´æ–° supportedCompressTypes map
var supportedCompressTypes = map[CompressType]struct{}{
    // ç°æœ‰æ ¼å¼...
    CompressTypeZlib:   {}, // ZLIB å‹ç¼©æ ¼å¼
    CompressTypeDeflate: {}, // DEFLATE å‹ç¼©æ ¼å¼
}

// æ›´æ–° DetectCompressFormat å‡½æ•°
func DetectCompressFormat(filename string) (CompressType, error) {
    // æ·»åŠ å¯¹ .zlib å’Œ .deflate æ‰©å±•åçš„æ”¯æŒ
}
```

### æ ¸å¿ƒé›†æˆæ›´æ–°

#### internal/core/comprx.go æ‰©å±•
```go
// åœ¨ Pack æ–¹æ³•ä¸­æ·»åŠ æ–°æ ¼å¼æ”¯æŒ
func (c *Comprx) Pack(dst string, src string) error {
    format, err := types.DetectCompressFormat(dst)
    if err != nil {
        return err
    }

    switch format {
    // ç°æœ‰æ ¼å¼å¤„ç†...
    case types.CompressTypeZlib:
        return cxzlib.Zlib(dst, src, c.Config)
    }
}

// åœ¨ Unpack æ–¹æ³•ä¸­æ·»åŠ æ–°æ ¼å¼æ”¯æŒ
func (c *Comprx) Unpack(src string, dst string) error {
    format, err := types.DetectCompressFormat(src)
    if err != nil {
        return err
    }

    switch format {
    // ç°æœ‰æ ¼å¼å¤„ç†...
    case types.CompressTypeZlib:
        return cxzlib.Unzlib(src, dst, c.Config)
    }
}
```

#### comprx.go ä¸»åŒ… API æ‰©å±•
```go
// ==================== ZLIB å†…å­˜å‹ç¼©API ====================

// ZlibBytes å‹ç¼©å­—èŠ‚æ•°æ®
func ZlibBytes(data []byte, level types.CompressionLevel) ([]byte, error) {
    return cxzlib.CompressBytes(data, level)
}

// UnzlibBytes è§£å‹å­—èŠ‚æ•°æ®
func UnzlibBytes(compressedData []byte) ([]byte, error) {
    return cxzlib.DecompressBytes(compressedData)
}

// ZlibString å‹ç¼©å­—ç¬¦ä¸²
func ZlibString(text string, level types.CompressionLevel) ([]byte, error) {
    return cxzlib.CompressString(text, level)
}

// UnzlibString è§£å‹ä¸ºå­—ç¬¦ä¸²
func UnzlibString(compressedData []byte) (string, error) {
    return cxzlib.DecompressString(compressedData)
}

// ==================== ZLIB æµå¼å‹ç¼©API ====================

// ZlibStream æµå¼å‹ç¼©æ•°æ®
func ZlibStream(dst io.Writer, src io.Reader) error {
    return cxzlib.CompressStream(dst, src, types.CompressionLevelDefault)
}

// ZlibStreamWithLevel æµå¼å‹ç¼©æ•°æ®ï¼ˆæŒ‡å®šå‹ç¼©ç­‰çº§ï¼‰
func ZlibStreamWithLevel(dst io.Writer, src io.Reader, level types.CompressionLevel) error {
    return cxzlib.CompressStream(dst, src, level)
}

// UnzlibStream æµå¼è§£å‹æ•°æ®
func UnzlibStream(dst io.Writer, src io.Reader) error {
    return cxzlib.DecompressStream(dst, src)
}

```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
internal/cxzlib/
â”œâ”€â”€ zlib_test.go      # å•æ–‡ä»¶å‹ç¼©æµ‹è¯•
â”œâ”€â”€ unzlib_test.go    # å•æ–‡ä»¶è§£å‹æµ‹è¯•
â”œâ”€â”€ memory_test.go    # å†…å­˜æ“ä½œå’Œæµå¼å¤„ç†æµ‹è¯•
â””â”€â”€ list_test.go      # æ–‡ä»¶åˆ—è¡¨æµ‹è¯•
```

### æµ‹è¯•ç”¨ä¾‹è¦†ç›–
1. **åŠŸèƒ½æµ‹è¯•**ï¼šåŸºæœ¬å‹ç¼©/è§£å‹åŠŸèƒ½
2. **è¾¹ç•Œæµ‹è¯•**ï¼šç©ºæ•°æ®ã€å¤§æ•°æ®ã€ç‰¹æ®Šå­—ç¬¦
3. **é”™è¯¯æµ‹è¯•**ï¼šæ— æ•ˆè¾“å…¥ã€æ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™é—®é¢˜
4. **æ€§èƒ½æµ‹è¯•**ï¼šå‹ç¼©ç‡ã€é€Ÿåº¦åŸºå‡†æµ‹è¯•
5. **å…¼å®¹æ€§æµ‹è¯•**ï¼šä¸æ ‡å‡†åº“çš„å…¼å®¹æ€§éªŒè¯
6. **å¹¶å‘æµ‹è¯•**ï¼šå¤šåç¨‹å®‰å…¨æ€§æµ‹è¯•

## ğŸ“š æ–‡æ¡£æ›´æ–°

### README.md æ›´æ–°å†…å®¹
1. **æ”¯æŒæ ¼å¼è¡¨æ ¼**ï¼šæ·»åŠ  ZLIB æ ¼å¼
2. **API ç¤ºä¾‹**ï¼šZLIB æ ¼å¼çš„ä½¿ç”¨ç¤ºä¾‹
3. **æ€§èƒ½å¯¹æ¯”**ï¼šZLIB ä¸å…¶ä»–æ ¼å¼çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯
4. **è¿ç§»æŒ‡å—**ï¼šä»å…¶ä»–åº“è¿ç§»çš„å»ºè®®

### API æ–‡æ¡£
1. **å‡½æ•°æ³¨é‡Š**ï¼šå®Œæ•´çš„å‚æ•°å’Œè¿”å›å€¼è¯´æ˜
2. **ä½¿ç”¨ç¤ºä¾‹**ï¼šæ¯ä¸ªä¸»è¦å‡½æ•°çš„ç¤ºä¾‹ä»£ç 
3. **æœ€ä½³å®è·µ**ï¼šæ¨èçš„ä½¿ç”¨æ¨¡å¼å’Œæ³¨æ„äº‹é¡¹

## âš¡ æ€§èƒ½ä¼˜åŒ–è€ƒè™‘

### å†…å­˜ä¼˜åŒ–
1. **ç¼“å†²åŒºå¤ç”¨**ï¼šä½¿ç”¨ utils åŒ…çš„ç¼“å†²åŒºæ± 
2. **é¢„åˆ†é…ç­–ç•¥**ï¼šæ ¹æ®æ•°æ®å¤§å°é¢„åˆ†é…åˆé€‚çš„ç¼“å†²åŒº
3. **æµå¼å¤„ç†**ï¼šé¿å…å¤§æ–‡ä»¶çš„å®Œæ•´å†…å­˜åŠ è½½

### é”™è¯¯å¤„ç†
1. **èµ„æºæ¸…ç†**ï¼šç¡®ä¿æ‰€æœ‰èµ„æºæ­£ç¡®é‡Šæ”¾
2. **é”™è¯¯åŒ…è£…**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
3. **å¿«é€Ÿå¤±è´¥**ï¼šå‚æ•°éªŒè¯å‰ç½®

## ğŸ”„ å…¼å®¹æ€§ä¿è¯

### å‘åå…¼å®¹
1. **API ç¨³å®šæ€§**ï¼šä¸ä¿®æ”¹ç°æœ‰ API ç­¾å
2. **è¡Œä¸ºä¸€è‡´æ€§**ï¼šæ–°æ ¼å¼éµå¾ªç°æœ‰è¡Œä¸ºæ¨¡å¼
3. **é…ç½®å…¼å®¹**ï¼šå¤ç”¨ç°æœ‰é…ç½®é€‰é¡¹

### æ ‡å‡†åº“å…¼å®¹
1. **å‹ç¼©çº§åˆ«æ˜ å°„**ï¼šæ­£ç¡®æ˜ å°„åˆ°æ ‡å‡†åº“çš„å‹ç¼©çº§åˆ«
2. **æ•°æ®æ ¼å¼**ï¼šç¡®ä¿ä¸æ ‡å‡†åº“ç”Ÿæˆçš„æ•°æ®å…¼å®¹
3. **é”™è¯¯å¤„ç†**ï¼šä¿æŒä¸æ ‡å‡†åº“ä¸€è‡´çš„é”™è¯¯ç±»å‹

## ğŸ“‹ å®ç°æ£€æŸ¥æ¸…å•

### é˜¶æ®µä¸€æ£€æŸ¥é¡¹
- [ ] types.go ä¸­æ·»åŠ æ–°æ ¼å¼å¸¸é‡
- [ ] æ›´æ–°æ ¼å¼æ£€æµ‹å‡½æ•°
- [ ] æ›´æ–°æ”¯æŒæ ¼å¼åˆ—è¡¨
- [ ] éªŒè¯é…ç½®ç³»ç»Ÿå…¼å®¹æ€§

### é˜¶æ®µäºŒæ£€æŸ¥é¡¹ï¼ˆZLIBï¼‰
- [ ] åˆ›å»º cxzlib ç›®å½•ç»“æ„
- [ ] å®ç° zlib.go å•æ–‡ä»¶å‹ç¼©
- [ ] å®ç° unzlib.go å•æ–‡ä»¶è§£å‹
- [ ] å®ç° memory.go å†…å­˜å’Œæµå¼æ“ä½œ
- [ ] å®ç° list.go æ–‡ä»¶åˆ—è¡¨åŠŸèƒ½
- [ ] ç¼–å†™å®Œæ•´æµ‹è¯•ç”¨ä¾‹
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 90% ä»¥ä¸Š

### é˜¶æ®µä¸‰æ£€æŸ¥é¡¹ï¼ˆæ ¸å¿ƒé›†æˆï¼‰
- [ ] æ›´æ–° core/comprx.go è·¯ç”±é€»è¾‘
- [ ] æ‰©å±•ä¸»åŒ… API å‡½æ•°
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•åŸºå‡†å»ºç«‹

### é˜¶æ®µäº”æ£€æŸ¥é¡¹ï¼ˆæµ‹è¯•å’Œæ–‡æ¡£ï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾åˆ°é¢„æœŸ
- [ ] README.md æ›´æ–°å®Œæˆ
- [ ] API æ–‡æ¡£å®Œå–„
- [ ] ç¤ºä¾‹ä»£ç éªŒè¯

## ğŸ¯ æˆåŠŸæ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šZLIB æ ¼å¼å®Œå…¨æ”¯æŒ
2. **API ä¸€è‡´æ€§**ï¼šä¸ç°æœ‰æ ¼å¼ä¿æŒä¸€è‡´çš„ API è®¾è®¡
3. **æ€§èƒ½è¡¨ç°**ï¼šå‹ç¼©ç‡å’Œé€Ÿåº¦ç¬¦åˆé¢„æœŸ
4. **æµ‹è¯•è¦†ç›–**ï¼šæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 90% ä»¥ä¸Š
5. **æ–‡æ¡£å®Œå–„**ï¼šç”¨æˆ·å¯ä»¥è½»æ¾ä¸Šæ‰‹ä½¿ç”¨
6. **å‘åå…¼å®¹**ï¼šä¸ç ´åç°æœ‰åŠŸèƒ½å’Œ API

é€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„å®ç°æ–¹æ¡ˆï¼Œå¯ä»¥ç¡®ä¿ ZLIB æ ¼å¼çš„é«˜è´¨é‡é›†æˆï¼ŒåŒæ—¶ä¿æŒé¡¹ç›®çš„æ•´ä½“æ¶æ„ä¸€è‡´æ€§å’Œä»£ç è´¨é‡ã€‚
